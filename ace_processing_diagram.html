<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACE Platform CSV Processing Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .diagram-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .diagram-title {
            font-size: 1.8em;
            color: #1e3a8a;
            margin-bottom: 20px;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 10px;
        }

        .diagram {
            width: 100%;
            overflow-x: auto;
            padding: 20px 0;
        }

        svg {
            display: block;
            margin: 0 auto;
        }

        .component {
            fill: #4299e1;
            stroke: #2b6cb0;
            stroke-width: 2;
        }

        .component-critical {
            fill: #f56565;
            stroke: #c53030;
            stroke-width: 2;
        }

        .component-success {
            fill: #48bb78;
            stroke: #2f855a;
            stroke-width: 2;
        }

        .component-warning {
            fill: #ed8936;
            stroke: #c05621;
            stroke-width: 2;
        }

        .component-info {
            fill: #667eea;
            stroke: #5a67d8;
            stroke-width: 2;
        }

        .component-storage {
            fill: #9f7aea;
            stroke: #805ad5;
            stroke-width: 2;
        }

        .component-ui {
            fill: #38b2ac;
            stroke: #319795;
            stroke-width: 2;
        }

        .component-process {
            fill: #4fd1c5;
            stroke: #319795;
            stroke-width: 2;
        }

        .text {
            fill: white;
            font-size: 14px;
            font-weight: 600;
            text-anchor: middle;
        }

        .text-small {
            fill: white;
            font-size: 11px;
            text-anchor: middle;
        }

        .text-dark {
            fill: #2d3748;
            font-size: 12px;
            font-weight: 500;
        }

        .arrow {
            stroke: #2d3748;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-success {
            stroke: #48bb78;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead-success);
        }

        .arrow-fail {
            stroke: #f56565;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead-fail);
        }

        .arrow-dashed {
            stroke: #718096;
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 5,5;
            marker-end: url(#arrowhead-dashed);
        }

        .label {
            fill: #2d3748;
            font-size: 12px;
            font-weight: 600;
        }

        .description {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 8px;
        }

        .csv-record {
            fill: #fef5e7;
            stroke: #f59e0b;
            stroke-width: 2;
        }

        .highlight-box {
            fill: none;
            stroke: #3b82f6;
            stroke-width: 3;
            stroke-dasharray: 10,5;
        }

        @media print {
            body {
                background: white;
            }
            .diagram-section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ACE Platform: CSV Processing Architecture</h1>

        <!-- Complete ACE Flow -->
        <div class="diagram-section">
            <h2 class="diagram-title">1. Complete ACE Processing Flow</h2>
            <div class="description">
                <strong>Overview:</strong> ACE receives CSV files from SFTP, creates delegator and child processes, generates human tasks for FAIL records, and provides UI for business users to take action.
            </div>
            <div class="diagram">
                <svg width="1500" height="900" viewBox="0 0 1500 900">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#2d3748" />
                        </marker>
                        <marker id="arrowhead-success" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#48bb78" />
                        </marker>
                        <marker id="arrowhead-fail" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#f56565" />
                        </marker>
                        <marker id="arrowhead-dashed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#718096" />
                        </marker>
                    </defs>

                    <!-- SFTP Zone -->
                    <rect x="30" y="30" width="250" height="300" fill="#fef5e7" stroke="#ed8936" stroke-width="3" rx="10"/>
                    <text x="155" y="60" font-size="18" font-weight="bold" fill="#c05621" text-anchor="middle">SFTP SERVER</text>

                    <!-- CSV File -->
                    <rect x="70" y="100" width="170" height="90" class="csv-record" rx="8"/>
                    <text x="155" y="125" class="text-dark" font-weight="bold">CSV File</text>
                    <text x="155" y="145" class="text-dark" font-size="10">Lumi_DQResults_</text>
                    <text x="155" y="160" class="text-dark" font-size="10">20260116.csv</text>
                    <text x="155" y="180" class="text-dark" font-size="10" font-weight="bold">10 Records</text>

                    <!-- Folder Structure -->
                    <rect x="70" y="220" width="170" height="80" class="component-warning" rx="8"/>
                    <text x="155" y="245" class="text-small">üìÅ Folders:</text>
                    <text x="155" y="260" class="text-small">Inbox ‚Üí Outbox</text>
                    <text x="155" y="275" class="text-small">‚Üí Send</text>
                    <text x="155" y="290" class="text-small">(24hr auto-delete)</text>

                    <!-- ACE Scheduler -->
                    <rect x="350" y="100" width="200" height="90" class="component-info" rx="10"/>
                    <text x="450" y="135" class="text">ACE Scheduler</text>
                    <text x="450" y="155" class="text-small">Hourly Check</text>
                    <text x="450" y="170" class="text-small">Profile: UCDO_PRD</text>

                    <!-- Download with Retry -->
                    <rect x="350" y="230" width="200" height="100" class="component" rx="10"/>
                    <text x="450" y="265" class="text">Download File</text>
                    <text x="450" y="285" class="text-small">Retry Logic (3x):</text>
                    <text x="450" y="300" class="text-small">1. Outbox ‚Üí 2. Send</text>
                    <text x="450" y="315" class="text-small">3. Final ‚Üí Alert</text>

                    <!-- File Validation -->
                    <path d="M 450 380 L 530 430 L 450 480 L 370 430 Z" class="component-warning"/>
                    <text x="450" y="425" class="text">File</text>
                    <text x="450" y="443" class="text">Empty?</text>

                    <!-- Empty Path -->
                    <rect x="100" y="390" width="180" height="80" class="component-success" rx="10"/>
                    <text x="190" y="420" class="text">Send Notification</text>
                    <text x="190" y="440" class="text-small">"No records for</text>
                    <text x="190" y="455" class="text-small">today's date"</text>

                    <!-- Has Records Path -->
                    <rect x="630" y="80" width="220" height="100" class="component-process" rx="10"/>
                    <text x="740" y="120" class="text">Delegator Process</text>
                    <text x="740" y="140" class="text-small">(Parent BPMN)</text>
                    <text x="740" y="155" class="text-small">Parse CSV</text>
                    <text x="740" y="170" class="text-small">Create Child Tasks</text>

                    <!-- Child Processes -->
                    <rect x="630" y="220" width="220" height="120" fill="#e0f2fe" stroke="#0284c7" stroke-width="3" rx="10"/>
                    <text x="740" y="250" font-size="14" font-weight="bold" fill="#0c4a6e" text-anchor="middle">Child Processes</text>
                    <text x="740" y="270" class="text-dark" font-size="11">10 Records ‚Üí 10 Children</text>
                    <text x="740" y="290" class="text-dark" font-size="11">Each contains:</text>
                    <text x="740" y="305" class="text-dark" font-size="10">TQID, Table, Rule, Date</text>
                    <text x="740" y="320" class="text-dark" font-size="10">Status, Actual/Expected</text>

                    <!-- Decision Diamond -->
                    <path d="M 740 390 L 830 450 L 740 510 L 650 450 Z" class="component-warning"/>
                    <text x="740" y="445" class="text">Status</text>
                    <text x="740" y="463" class="text">Code?</text>

                    <!-- PASS Branch -->
                    <rect x="900" y="200" width="220" height="100" class="component-success" rx="10"/>
                    <text x="1010" y="240" class="text">PASS Records</text>
                    <text x="1010" y="260" class="text-small">Auto-Complete</text>
                    <text x="1010" y="275" class="text-small">No Human Task</text>
                    <text x="1010" y="290" class="text-small">Log to Audit</text>

                    <!-- FAIL Branch -->
                    <rect x="900" y="400" width="220" height="100" class="component-critical" rx="10"/>
                    <text x="1010" y="440" class="text">FAIL Records</text>
                    <text x="1010" y="460" class="text-small">Create Human Task</text>
                    <text x="1010" y="475" class="text-small">Expose in DQIM UI</text>
                    <text x="1010" y="490" class="text-small">Await User Action</text>

                    <!-- DQIM UI -->
                    <rect x="1180" y="350" width="280" height="200" class="component-ui" rx="10"/>
                    <text x="1320" y="385" class="text" font-size="16">DQIM Portal UI</text>
                    <text x="1320" y="410" class="text-small">User Actions Available:</text>
                    <text x="1320" y="430" class="text-small">‚úì Reserve Task</text>
                    <text x="1320" y="448" class="text-small">‚úì Mark False Positive</text>
                    <text x="1320" y="466" class="text-small">‚úì Request Rule Change</text>
                    <text x="1320" y="484" class="text-small">‚úì Request Rule Delete</text>
                    <text x="1320" y="502" class="text-small">‚úì Create ServiceNow</text>
                    <text x="1320" y="520" class="text-small">‚úì Add Comments</text>

                    <!-- ACE Control Center -->
                    <rect x="630" y="570" width="220" height="120" class="component-info" rx="10"/>
                    <text x="740" y="605" class="text">ACE Control Center</text>
                    <text x="740" y="625" class="text-small">Monitor Processes</text>
                    <text x="740" y="640" class="text-small">View Variables</text>
                    <text x="740" y="655" class="text-small">Resume Failed Jobs</text>
                    <text x="740" y="670" class="text-small">Track Completion</text>

                    <!-- ServiceNow -->
                    <rect x="1180" y="600" width="280" height="90" class="component-warning" rx="10"/>
                    <text x="1320" y="635" class="text">ServiceNow</text>
                    <text x="1320" y="655" class="text-small">Incident Creation</text>
                    <text x="1320" y="670" class="text-small">SLA Tracking</text>

                    <!-- Audit Trail -->
                    <rect x="350" y="700" width="500" height="90" class="component-storage" rx="10"/>
                    <text x="600" y="735" class="text">Audit Trail & Logging</text>
                    <text x="600" y="755" class="text-small">Who | What | When | Why | Outcome</text>
                    <text x="600" y="770" class="text-small">Complete Traceability for Compliance</text>

                    <!-- Arrows -->
                    <path d="M 240 145 L 350 145" class="arrow"/>
                    <text x="280" y="135" class="label">Download</text>

                    <path d="M 450 190 L 450 230" class="arrow"/>

                    <path d="M 450 330 L 450 380" class="arrow"/>

                    <!-- Empty branch -->
                    <path d="M 370 430 L 280 430" class="arrow-success"/>
                    <text x="310" y="420" class="label" fill="#48bb78">YES</text>

                    <!-- Has records -->
                    <path d="M 530 430 L 630 130" class="arrow-fail"/>
                    <text x="570 " y="280" class="label" fill="#f56565">NO (Has Data)</text>

                    <path d="M 740 180 L 740 220" class="arrow"/>

                    <path d="M 740 340 L 740 390" class="arrow"/>

                    <!-- PASS path -->
                    <path d="M 830 450 L 900 250" class="arrow-success"/>
                    <text x="850" y="340" class="label" fill="#48bb78">PASS</text>

                    <!-- FAIL path -->
                    <path d="M 830 450 L 900 450" class="arrow-fail"/>
                    <text x="850" y="440" class="label" fill="#f56565">FAIL</text>

                    <!-- To UI -->
                    <path d="M 1120 450 L 1180 450" class="arrow"/>

                    <!-- To ServiceNow -->
                    <path d="M 1320 550 L 1320 600" class="arrow-dashed"/>
                    <text x="1340" y="575" class="label" font-size="10">If true issue</text>

                    <!-- To Control Center -->
                    <path d="M 740 510 L 740 570" class="arrow-dashed"/>

                    <!-- To Audit -->
                    <path d="M 1010 500 L 850 700" class="arrow-dashed"/>
                    <path d="M 740 690 L 740 700" class="arrow-dashed"/>
                    <path d="M 1320 690 L 850 745" class="arrow-dashed"/>

                    <!-- Stats Box -->
                    <rect x="30" y="550" width="280" height="150" fill="#f0fdf4" stroke="#48bb78" stroke-width="3" rx="10"/>
                    <text x="170" y="580" font-size="14" font-weight="bold" fill="#166534" text-anchor="middle">Processing Stats Example</text>
                    <text x="45" y="605" font-size="11" fill="#166534">üìä CSV Records: 10</text>
                    <text x="45" y="625" font-size="11" fill="#166534">‚úÖ PASS: 7 (Auto-completed)</text>
                    <text x="45" y="645" font-size="11" fill="#dc2626">‚ùå FAIL: 3 (Human Tasks)</text>
                    <text x="45" y="665" font-size="11" fill="#0284c7">üë• Tasks in UI: 3</text>
                    <text x="45" y="685" font-size="11" fill="#7c3aed">‚è± Process Time: ~2 min</text>

                    <!-- Retry Box -->
                    <rect x="30" y="730" width="280" height="80" fill="#fef2f2" stroke="#dc2626" stroke-width="2" rx="8"/>
                    <text x="170" y="755" font-size="12" font-weight="bold" fill="#991b1b" text-anchor="middle">Retry & Alert Logic</text>
                    <text x="45" y="775" font-size="10" fill="#991b1b">‚ùå Download Fail ‚Üí Retry 3x</text>
                    <text x="45" y="795" font-size="10" fill="#991b1b">üìß All Retries Fail ‚Üí Slack/Email Alert</text>
                </svg>
            </div>
        </div>

        <!-- BPMN Process Detail -->
        <div class="diagram-section">
            <h2 class="diagram-title">2. BPMN Delegator & Child Process Architecture</h2>
            <div class="description">
                <strong>Process Hierarchy:</strong> One delegator (parent) process spawns multiple child processes. Each child represents one CSV record and executes independently based on its status code.
            </div>
            <div class="diagram">
                <svg width="1400" height="800" viewBox="0 0 1400 800">
                    <!-- CSV Input -->
                    <rect x="50" y="50" width="300" height="200" class="csv-record" rx="10"/>
                    <text x="200" y="80" class="text-dark" font-size="16" font-weight="bold">CSV File Content (3 Records)</text>
                    
                    <rect x="70" y="100" width="260" height="35" fill="white" stroke="#f59e0b" stroke-width="1" rx="4"/>
                    <text x="80" y="122" class="text-dark" font-size="10" text-anchor="start">TQID: 123 | employee_table | FAIL</text>

                    <rect x="70" y="145" width="260" height="35" fill="white" stroke="#f59e0b" stroke-width="1" rx="4"/>
                    <text x="80" y="167" class="text-dark" font-size="10" text-anchor="start">TQID: 124 | sales_table | PASS</text>

                    <rect x="70" y="190" width="260" height="35" fill="white" stroke="#f59e0b" stroke-width="1" rx="4"/>
                    <text x="80" y="212" class="text-dark" font-size="10" text-anchor="start">TQID: 125 | customer_table | FAIL</text>

                    <!-- Delegator Process -->
                    <rect x="450" y="50" width="280" height="200" class="component-process" rx="10"/>
                    <text x="590" y="90" class="text" font-size="18">Delegator Process</text>
                    <text x="590" y="115" class="text-small">(Parent BPMN)</text>
                    <text x="590" y="140" class="text-small">Process ID: DEL-2026-001</text>
                    <text x="590" y="160" class="text-small">Status: Active</text>
                    <text x="590" y="180" class="text-small">Child Count: 3</text>
                    <text x="590" y="200" class="text-small">Completed: 0/3</text>
                    <text x="590" y="220" class="text-small">Created: 2026-01-16 11:00</text>

                    <!-- Child Process 1 - FAIL -->
                    <rect x="850" y="20" width="250" height="180" class="component-critical" rx="10"/>
                    <text x="975" y="50" class="text" font-size="14">Child Process 1</text>
                    <text x="975" y="70" class="text-small">ID: CHILD-123</text>
                    <text x="975" y="90" class="text-small">TQID: 123</text>
                    <text x="975" y="105" class="text-small">Table: employee_table</text>
                    <text x="975" y="120" class="text-small">Rule: Email not null</text>
                    <text x="975" y="135" class="text-small">Status Code: FAIL</text>
                    <text x="975" y="150" class="text-small">Expected: 0 | Actual: 5</text>
                    <text x="975" y="170" class="text-small" font-weight="bold">‚Üí CREATE HUMAN TASK</text>

                    <!-- Child Process 2 - PASS -->
                    <rect x="850" y="220" width="250" height="180" class="component-success" rx="10"/>
                    <text x="975" y="250" class="text" font-size="14">Child Process 2</text>
                    <text x="975" y="270" class="text-small">ID: CHILD-124</text>
                    <text x="975" y="290" class="text-small">TQID: 124</text>
                    <text x="975" y="305" class="text-small">Table: sales_table</text>
                    <text x="975" y="320" class="text-small">Rule: Daily threshold</text>
                    <text x="975" y="335" class="text-small">Status Code: PASS</text>
                    <text x="975" y="350" class="text-small">Expected: 1000-1500 | Actual: 1250</text>
                    <text x="975" y="370" class="text-small" font-weight="bold">‚Üí AUTO-COMPLETE</text>

                    <!-- Child Process 3 - FAIL -->
                    <rect x="850" y="420" width="250" height="180" class="component-critical" rx="10"/>
                    <text x="975" y="450" class="text" font-size="14">Child Process 3</text>
                    <text x="975" y="470" class="text-small">ID: CHILD-125</text>
                    <text x="975" y="490" class="text-small">TQID: 125</text>
                    <text x="975" y="505" class="text-small">Table: customer_table</text>
                    <text x="975" y="520" class="text-small">Rule: No duplicates</text>
                    <text x="975" y="535" class="text-small">Status Code: FAIL</text>
                    <text x="975" y="550" class="text-small">Expected: 0 | Actual: 2</text>
                    <text x="975" y="570" class="text-small" font-weight="bold">‚Üí CREATE HUMAN TASK</text>

                    <!-- Human Tasks in UI -->
                    <rect x="1150" y="50" width="200" height="120" class="component-ui" rx="10"/>
                    <text x="1250" y="85" class="text">Human Task #1</text>
                    <text x="1250" y="105" class="text-small">TQID: 123</text>
                    <text x="1250" y="120" class="text-small">Status: Open</text>
                    <text x="1250" y="135" class="text-small">Reserved: None</text>
                    <text x="1250" y="155" class="text-small" font-weight="bold">Awaiting Action</text>

                    <!-- Completed Marker -->
                    <rect x="1150" y="200" width="200" height="100" fill="#d1fae5" stroke="#10b981" stroke-width="3" rx="10"/>
                    <text x="1250" y="235" font-size="14" font-weight="bold" fill="#065f46" text-anchor="middle">‚úì Completed</text>
                    <text x="1250" y="255" class="text-dark">TQID: 124</text>
                    <text x="1250" y="275" class="text-dark">Auto-closed</text>

                    <!-- Human Tasks in UI -->
                    <rect x="1150" y="350" width="200" height="120" class="component-ui" rx="10"/>
                    <text x="1250" y="385" class="text">Human Task #2</text>
                    <text x="1250" y="405" class="text-small">TQID: 125</text>
                    <text x="1250" y="420" class="text-small">Status: Open</text>
                    <text x="1250" y="435" class="text-small">Reserved: None</text>
                    <text x="1250" y="455" class="text-small" font-weight="bold">Awaiting Action</text>

                    <!-- Process Variables Box -->
                    <rect x="50" y="300" width="680" height="220" fill="#eff6ff" stroke="#3b82f6" stroke-width="3" rx="10"/>
                    <text x="390" y="330" font-size="16" font-weight="bold" fill="#1e40af" text-anchor="middle">Process Variables (Stored in Each Child)</text>
                    
                    <text x="70" y="360" class="text-dark" font-weight="bold">Variable Name</text>
                    <text x="300" y="360" class="text-dark" font-weight="bold">Example Value</text>
                    <text x="520" y="360" class="text-dark" font-weight="bold">Purpose</text>

                    <text x="70" y="385" class="text-dark" font-size="11">TQID</text>
                    <text x="300" y="385" class="text-dark" font-size="11">123</text>
                    <text x="520" y="385" class="text-dark" font-size="11">Unique Task Identifier</text>

                    <text x="70" y="405" class="text-dark" font-size="11">TableName</text>
                    <text x="300" y="405" class="text-dark" font-size="11">employee_table</text>
                    <text x="520" y="405" class="text-dark" font-size="11">Source Table</text>

                    <text x="70" y="425" class="text-dark" font-size="11">RuleDescription</text>
                    <text x="300" y="425" class="text-dark" font-size="11">Email ID should not be null</text>
                    <text x="520" y="425" class="text-dark" font-size="11">What rule checks</text>

                    <text x="70" y="445" class="text-dark" font-size="11">RuleDate</text>
                    <text x="300" y="445" class="text-dark" font-size="11">2026-01-16</text>
                    <text x="520" y="445" class="text-dark" font-size="11">Execution date</text>

                    <text x="70" y="465" class="text-dark" font-size="11">StatusCode</text>
                    <text x="300" y="465" class="text-dark" font-size="11" font-weight="bold" fill="#dc2626">FAIL</text>
                    <text x="520" y="465" class="text-dark" font-size="11">Pass/Fail indicator</text>

                    <text x="70" y="485" class="text-dark" font-size="11">ExpectedValue</text>
                    <text x="300" y="485" class="text-dark" font-size="11">0</text>
                    <text x="520" y="485"